{"ast":null,"code":"import _slicedToArray from \"/Users/wileyconte/projects/orderBook/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/wileyconte/projects/orderBook/src/components/OrderBookTable.js\";\nimport React, { useState, useEffect } from \"react\";\nimport LoaderIcon from \"react-loader-icon\";\nimport PairSelect from \"./PairSelect\";\nexport default function OrderBookTable(props) {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        poloAsks = _useState2[0],\n        setPoloAsks = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        bittrexAsks = _useState4[0],\n        setBittrexAsks = _useState4[1];\n\n  const _useState5 = useState([]),\n        _useState6 = _slicedToArray(_useState5, 2),\n        poloBids = _useState6[0],\n        setPoloBids = _useState6[1];\n\n  const _useState7 = useState([]),\n        _useState8 = _slicedToArray(_useState7, 2),\n        bittrexBids = _useState8[0],\n        setBittrexBids = _useState8[1];\n\n  const _useState9 = useState(6),\n        _useState10 = _slicedToArray(_useState9, 2),\n        depth = _useState10[0],\n        setDepth = _useState10[1];\n\n  const _useState11 = useState(9),\n        _useState12 = _slicedToArray(_useState11, 2),\n        decimalAccuracy = _useState12[0],\n        setDecimalAccuracy = _useState12[1];\n\n  const _useState13 = useState(false),\n        _useState14 = _slicedToArray(_useState13, 2),\n        loaded = _useState14[0],\n        setLoaded = _useState14[1];\n\n  const exchangeDepth = depth / 2; // const proxyURL   = \"https://cors-anywhere.herokuapp.com/\",\n  //       poloURL    = \"https://poloniex.com/public?command=returnOrderBook&currencyPair=\"+pair+\"&depth=\"+exchangeDepth,\n  //       bittrexURL = \"https://api.bittrex.com/api/v1.1/public/getorderbook?market=\"+pair.replace(/_/g, '-')+\"&type=both\"\n\n  const fetchBooks = async pair => {\n    const proxyURL = \"https://cors-anywhere.herokuapp.com/\",\n          poloURL = \"https://poloniex.com/public?command=returnOrderBook&currencyPair=\" + pair + \"&depth=\" + exchangeDepth,\n          bittrexURL = \"https://api.bittrex.com/api/v1.1/public/getorderbook?market=\" + pair.replace(/_/g, '-') + \"&type=both\";\n    await fetch(proxyURL + poloURL).then(res => {\n      return res.json();\n    }).then(resData => {\n      setPoloAsks(normalizePolo(resData.asks));\n      setPoloBids(normalizePolo(resData.bids));\n    }).catch(err => {\n      console.log(err);\n      console.log('test');\n    });\n    await fetch(proxyURL + bittrexURL).then(res => {\n      return res.json();\n    }).then(resData => {\n      setBittrexBids(normalizeBittrex(resData.result.buy.slice(0, exchangeDepth)));\n      setBittrexAsks(normalizeBittrex(resData.result.sell.slice(0, exchangeDepth)));\n    }).catch(err => {\n      console.log(err);\n    });\n  }; // const fetchBittrex = async () => {\n  //   await fetch(proxyURL+bittrexURL)\n  //     .then(res => {\n  //       return res.json();\n  //     })\n  //     .then(resData => {\n  //       setBittrexBids(normalizeBittrex(resData.result.buy.slice(0, exchangeDepth)))\n  //       setBittrexAsks(normalizeBittrex(resData.result.sell.slice(0, exchangeDepth)))\n  //     })\n  //     .catch(err => {\n  //       console.log(err)\n  //     })\n  // }\n\n\n  const normalizePolo = obj => {\n    let newArr = obj.map(val => {\n      return [parseFloat(val[0]), val[1], \"Poloniex\"];\n    });\n    return newArr;\n  };\n\n  const normalizeBittrex = obj => {\n    const arr = obj.map(Object.values);\n    const newArr = arr.map(val => val.reverse());\n    return newArr.map(val => {\n      return [val[0], val[1], \"Bittrex\"];\n    });\n  };\n\n  const totalAsks = [...poloAsks, ...bittrexAsks].sort((a, b) => a - b);\n  const totalBids = [...poloBids, ...bittrexBids].sort((a, b) => b - a);\n  const lowestAsk = totalAsks.filter((item, _, arr) => item === arr[0]).flat();\n  const highestBid = totalBids.filter((item, _, arr) => item === arr[0]).flat();\n  const spread = (lowestAsk[0] - highestBid[0]).toFixed(decimalAccuracy);\n  useEffect(() => {\n    fetchBooks(props.pairSelected);\n    const interval = setInterval(() => {\n      fetchBooks(props.pairSelected); // fetchBittrex(props.pairSelected)\n\n      setLoaded(true);\n    }, 3000);\n    return () => clearInterval(interval);\n  }, []); // const combineBooks = arr => {\n  //   let a = arr.concat();\n  //   for (let i=0; i<a.length; i++) {\n  //       for(let j=i+1; j<a.length; j++) {\n  //           if(a[i][0] === a[j][0]) {\n  //             a.splice(j--, 1)\n  //             console.log(a)\n  //           }\n  //       }\n  //   }\n  //\n  //   return a;\n  // }\n\n  const asksTable = totalAsks.reverse().map(ask => {\n    return React.createElement(\"tr\", {\n      key: Math.random(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, ask[0]), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, ask[1]), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, ask[2]));\n  });\n  const bidsTable = totalBids.map(bid => {\n    return React.createElement(\"tr\", {\n      key: Math.random(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, bid[0]), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, bid[1]), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, bid[2]));\n  });\n  return React.createElement(\"section\", {\n    style: {\n      marginTop: \"5%\",\n      marginBottom: \"5%\",\n      marginLeft: \"25%\",\n      marginRight: \"25%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, \"Orderbook\"), React.createElement(PairSelect, {\n    pairSelected: props.pairSelected,\n    setPairSelected: props.setPairSelected,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    style: {\n      marginTop: \"2%\"\n    },\n    className: \"tbl-header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, React.createElement(\"table\", {\n    cellPadding: \"0\",\n    cellSpacing: \"0\",\n    border: \"0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"thead\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \"Price (\\u20BF)\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, \"Quantity\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, \"Exchange\"))))), React.createElement(\"div\", {\n    className: \"tbl-content\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, !loaded && React.createElement(LoaderIcon, {\n    color: \"white\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }), loaded && React.createElement(\"table\", {\n    cellPadding: \"0\",\n    cellSpacing: \"0\",\n    border: \"0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, React.createElement(\"tbody\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, asksTable, React.createElement(\"tr\", {\n    style: {\n      borderTop: \"none\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    style: {\n      color: \"orange\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, \"Asks\"), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  })), React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(\"strong\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, \"Spread: \", spread)), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  })), React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    style: {\n      color: \"#98f542\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, \"Bids\"), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  })), bidsTable))));\n}","map":{"version":3,"sources":["/Users/wileyconte/projects/orderBook/src/components/OrderBookTable.js"],"names":["React","useState","useEffect","LoaderIcon","PairSelect","OrderBookTable","props","poloAsks","setPoloAsks","bittrexAsks","setBittrexAsks","poloBids","setPoloBids","bittrexBids","setBittrexBids","depth","setDepth","decimalAccuracy","setDecimalAccuracy","loaded","setLoaded","exchangeDepth","fetchBooks","pair","proxyURL","poloURL","bittrexURL","replace","fetch","then","res","json","resData","normalizePolo","asks","bids","catch","err","console","log","normalizeBittrex","result","buy","slice","sell","obj","newArr","map","val","parseFloat","arr","Object","values","reverse","totalAsks","sort","a","b","totalBids","lowestAsk","filter","item","_","flat","highestBid","spread","toFixed","pairSelected","interval","setInterval","clearInterval","asksTable","ask","Math","random","bidsTable","bid","marginTop","marginBottom","marginLeft","marginRight","setPairSelected","borderTop","color"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\nimport LoaderIcon from \"react-loader-icon\";\nimport PairSelect from \"./PairSelect\"\n\nexport default function OrderBookTable(props) {\n\n  const [poloAsks, setPoloAsks] = useState([])\n  const [bittrexAsks, setBittrexAsks] = useState([])\n  const [poloBids, setPoloBids] = useState([])\n  const [bittrexBids, setBittrexBids] = useState([])\n  const [depth, setDepth] = useState(6)\n  const [decimalAccuracy, setDecimalAccuracy] = useState(9)\n  const [loaded, setLoaded] = useState(false)\n\n  const exchangeDepth = depth/2\n\n  // const proxyURL   = \"https://cors-anywhere.herokuapp.com/\",\n  //       poloURL    = \"https://poloniex.com/public?command=returnOrderBook&currencyPair=\"+pair+\"&depth=\"+exchangeDepth,\n  //       bittrexURL = \"https://api.bittrex.com/api/v1.1/public/getorderbook?market=\"+pair.replace(/_/g, '-')+\"&type=both\"\n\n  const fetchBooks = async pair => {\n\n    const proxyURL   = \"https://cors-anywhere.herokuapp.com/\",\n          poloURL    = \"https://poloniex.com/public?command=returnOrderBook&currencyPair=\"+pair+\"&depth=\"+exchangeDepth,\n          bittrexURL = \"https://api.bittrex.com/api/v1.1/public/getorderbook?market=\"+pair.replace(/_/g, '-')+\"&type=both\"\n\n    await fetch(proxyURL+poloURL)\n      .then(res => {\n        return res.json();\n      })\n      .then(resData => {\n        setPoloAsks(normalizePolo(resData.asks))\n        setPoloBids(normalizePolo(resData.bids))\n      })\n      .catch(err => {\n        console.log(err)\n        console.log('test')\n      })\n\n      await fetch(proxyURL+bittrexURL)\n        .then(res => {\n          return res.json();\n        })\n        .then(resData => {\n          setBittrexBids(normalizeBittrex(resData.result.buy.slice(0, exchangeDepth)))\n          setBittrexAsks(normalizeBittrex(resData.result.sell.slice(0, exchangeDepth)))\n        })\n        .catch(err => {\n          console.log(err)\n        })\n  }\n\n  // const fetchBittrex = async () => {\n  //   await fetch(proxyURL+bittrexURL)\n  //     .then(res => {\n  //       return res.json();\n  //     })\n  //     .then(resData => {\n  //       setBittrexBids(normalizeBittrex(resData.result.buy.slice(0, exchangeDepth)))\n  //       setBittrexAsks(normalizeBittrex(resData.result.sell.slice(0, exchangeDepth)))\n  //     })\n  //     .catch(err => {\n  //       console.log(err)\n  //     })\n  // }\n\n  const normalizePolo = obj => {\n    let newArr = obj.map(val => {\n      return [parseFloat(val[0]), val[1], \"Poloniex\"]\n    })\n    return newArr\n  }\n\n  const normalizeBittrex = obj => {\n    const arr = obj.map(Object.values)\n    const newArr = arr.map(val => val.reverse())\n    return newArr.map(val => {\n      return [val[0], val[1], \"Bittrex\"]\n    })\n  }\n\n  const totalAsks = [...poloAsks, ...bittrexAsks].sort((a,b) => (a-b))\n  const totalBids = [...poloBids, ...bittrexBids].sort((a,b) => (b-a))\n\n  const lowestAsk = totalAsks.filter((item, _, arr) => item === arr[0]).flat()\n  const highestBid = totalBids.filter((item, _, arr) => item === arr[0]).flat()\n\n  const spread = (lowestAsk[0] - highestBid[0]).toFixed(decimalAccuracy)\n\n  useEffect(() => {\n        fetchBooks(props.pairSelected)\n    const interval = setInterval(() => {\n        fetchBooks(props.pairSelected)\n        // fetchBittrex(props.pairSelected)\n        setLoaded(true)\n\n    }, 3000);\n    return () => clearInterval(interval);\n  }, [])\n\n  // const combineBooks = arr => {\n  //   let a = arr.concat();\n  //   for (let i=0; i<a.length; i++) {\n  //       for(let j=i+1; j<a.length; j++) {\n  //           if(a[i][0] === a[j][0]) {\n  //             a.splice(j--, 1)\n  //             console.log(a)\n  //           }\n  //       }\n  //   }\n  //\n  //   return a;\n  // }\n\n\n  const asksTable = totalAsks.reverse().map(ask => {\n      return (\n        <tr key={Math.random()}>\n          <td>{ask[0]}</td>\n          <td>{ask[1]}</td>\n          <td>{ask[2]}</td>\n        </tr>\n      )\n    })\n\n  const bidsTable = totalBids.map(bid => {\n    return (\n      <tr key={Math.random()}>\n        <td>{bid[0]}</td>\n        <td>{bid[1]}</td>\n        <td>{bid[2]}</td>\n      </tr>\n    )\n  })\n\n  return (\n\n    <section style={{marginTop: \"5%\", marginBottom: \"5%\", marginLeft: \"25%\", marginRight: \"25%\"}}>\n      <h1>Orderbook</h1>\n      <PairSelect pairSelected={props.pairSelected} setPairSelected={props.setPairSelected} />\n      <div style={{marginTop: \"2%\"}} className=\"tbl-header\">\n      <table cellPadding=\"0\" cellSpacing=\"0\" border=\"0\">\n        <thead>\n          <tr>\n            <th>Price (₿)</th>\n            <th>Quantity</th>\n            <th>Exchange</th>\n          </tr>\n        </thead>\n      </table>\n      </div>\n      <div className=\"tbl-content\">\n        {!loaded && <LoaderIcon color={\"white\"} />}\n        {loaded &&\n        <table cellPadding=\"0\" cellSpacing=\"0\" border=\"0\">\n        <tbody>\n          {asksTable}\n          <tr style={{borderTop: \"none\"}}>\n            <td style={{color: \"orange\"}}>Asks</td>\n            <td />\n            <td />\n          </tr>\n          <tr>\n            <td><strong>Spread: {spread}</strong></td>\n            <td />\n            <td />\n          </tr>\n          <tr>\n            <td style={{color: \"#98f542\"}}>Bids</td>\n            <td />\n            <td />\n          </tr>\n          {bidsTable}\n        </tbody>\n      </table>}\n    </div>\n  </section>\n\n  )\n}\n"]},"metadata":{},"sourceType":"module"}